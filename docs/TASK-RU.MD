# Тестовое задание для .NET разработчика: Сервис управления задачами с событиями

## Цель:
Разработать API-сервис для управления задачами пользователя с поддержкой синхронного и асинхронного межсервисного взаимодействия.

## Задачи:

### 1. **Разработка CRUD API для управления задачами**
   - Реализовать создание, получение, обновление и удаление задач
   - Каждая задача должна содержать: название, описание, статус (новая/в работе/выполненная), даты создания и изменения
   - Обеспечить валидацию данных и корректную обработку статусов задач

### 2. **Синхронное межсервисное взаимодействие**
   - Реализовать отдельный HTTP endpoint для приема событий о изменениях задач
   - При каждом изменении задачи в основном сервисе отправлять событие в сервис-логгер
   - Обеспечить обработку случаев недоступности сервиса-логгера

### 3. **Асинхронное взаимодействие через message broker** (опционально, но желательно)
   - Настроить отправку событий в Kafka/RabbitMQ при операциях с задачами
   - Реализовать фоновый сервис-потребитель для обработки событий из очереди
   - Обеспечить надежную доставку сообщений и обработку дубликатов

### 4. **Логирование и observability**
   - Реализовать структурированное логирование всех операций
   - Добавить трассировку операций (OpenTelemetry) для отслеживания workflow

### 5. **Обеспечение надежности и производительности**
   - Реализовать обработку длительных операций и таймаутов
   - Предусмотреть механизмы повторных попыток при сбоях

## Технические требования:
- **Язык программирования:** .NET 8 / ASP.NET Core
- **База данных:** PostgreSQL или MS SQL Server с EF Core
- **Message broker:** Kafka или RabbitMQ (для асинхронной части)
- **Документация API** в формате OpenAPI/Swagger
- Код должен быть **покрыт unit-тестами**
- **Архитектура:** чистая архитектура с соблюдением принципов SOLID

## Дополнительные задачи (необязательные):
- **Контейнеризация:** Dockerfile и docker-compose для всего стека
- **Аутентификация:** JWT-аутентификация для доступа к API
- **Кэширование:** Redis для кэширования часто запрашиваемых задач
- **Health checks:** эндпоинты для мониторинга состояния сервиса

## Результаты:
- Исходный код приложения на **GitHub** с читаемым README
- **Инструкция по запуску** проекта (локально и через Docker)
- **Архитектурное описание** решения и принятых решений
- Демонстрация работы **синхронного и асинхронного взаимодействия**

## Критерии оценки:
- Качество архитектуры и соблюдение SOLID принципов
- Надежность обработки ошибок и edge cases
- Чистота и читаемость кода
- Полнота реализации заявленных требований
- Качество тестов и документации


# Задание 2: SQL Функция для анализа платежей

## Цель задания
Необходимо написать табличную функцию SQL, которая будет возвращать по ClientId и интервалу дат (тип Date) поденные суммы платежей. Если за указанный день не было платежей, то функция должна возвращать 0. Интервалы дат могут охватывать несколько лет.

## Структура данных
Таблица платежей клиентов `ClientPayments`:

```sql
ClientPayments
(
    Id bigint,          -- первичный ключ таблицы
    ClientId bigint,    -- Id клиента
    Dt datetime2(0),    -- дата платежа
    Amount money        -- сумма платежа
)
```

## Пример входных данных

| Id | ClientId | Dt                  | Amount |
|----|----------|---------------------|--------|
| 1  | 1        | 2022-01-03 17:24:00 | 100    |
| 2  | 1        | 2022-01-05 17:24:14 | 200    |
| 3  | 1        | 2022-01-05 18:23:34 | 250    |
| 4  | 1        | 2022-01-07 10:12:38 | 50     |
| 5  | 2        | 2022-01-05 17:24:14 | 278    |
| 6  | 2        | 2022-01-10 12:39:29 | 300    |

## Требования к функции
- Функция должна принимать три параметра:
  - `@ClientId` - идентификатор клиента
  - `@StartDate` - начальная дата периода (тип Date)
  - `@EndDate` - конечная дата периода (тип Date)
- Функция должна возвращать таблицу с колонками:
  - `Dt` - дата (тип Date)
  - `Сумма` - сумма платежей за день (тип money)
- Для дней, когда не было платежей, должна возвращаться сумма 0
- Должны быть включены все дни в указанном диапазоне (включая начальную и конечную даты)

## Примеры работы функции

### Пример 1

**Входные параметры:**
- `ClientId` = 1
- `StartDate` = 2022-01-02
- `EndDate` = 2022-01-07

**Результат работы функции:**

| Dt         | Сумма |
|------------|-------|
| 2022-01-02 | 0     |
| 2022-01-03 | 100   |
| 2022-01-04 | 0     |
| 2022-01-05 | 450   |
| 2022-01-06 | 0     |
| 2022-01-07 | 50    |

### Пример 2

**Входные параметры:**
- `ClientId` = 2
- `StartDate` = 2022-01-04
- `EndDate` = 2022-01-11

**Результат работы функции:**

| Dt         | Сумма |
|------------|-------|
| 2022-01-04 | 0     |
| 2022-01-05 | 278   |
| 2022-01-06 | 0     |
| 2022-01-07 | 0     |
| 2022-01-08 | 0     |
| 2022-01-09 | 0     |
| 2022-01-10 | 300   |
| 2022-01-11 | 0     |

## Примечания
- Функция должна работать корректно для периодов, охватывающих несколько лет
- Необходимо обеспечить оптимальную производительность при работе с большими объемами данных
- Рекомендуется использовать рекурсивные CTE или таблицы чисел для генерации последовательности дат